<!DOCTYPE html>
<html>

<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, shrink-to-fit=no">
    <Title>Namsor</title>

    <!-- Favicon -->
    <link rel="shortcut icon" href="assets/images/logo/favicon.png">

    <!-- plugins css -->
    <link rel="stylesheet" href="bower_components/bootstrap/dist/css/bootstrap.css" />
    <link rel="stylesheet" href="bower_components/PACE/themes/blue/pace-theme-minimal.css" />
    <link rel="stylesheet" href="bower_components/perfect-scrollbar/css/perfect-scrollbar.min.css" />
    <!-- core css -->
    <link href="assets/css/ei-icon.css" rel="stylesheet">
    <link href="assets/css/themify-icons.css" rel="stylesheet">
    <link href="assets/css/font-awesome.min.css" rel="stylesheet">
    <link href="assets/css/animate.min.css" rel="stylesheet">
    <link href="assets/css/app.css" rel="stylesheet">
    <link href="assets/css/own.css" rel="stylesheet">
</head>

<body>
    <div class="app side-nav-dark">
        <div class="layout">
          <!-- Side Nav START -->
          <div class="side-nav">
            <div class="side-nav-inner">
              <div class="side-nav-logo">
                <a href="index.html">
                  <div class="logo logo-dark" style="background-image: url('assets/images/logo/logo.png')"></div>
                  <div class="logo logo-white" style="background-image: url('assets/images/logo/logo.png')"></div>

                </a>
                <div class="mobile-toggle side-nav-toggle">
                  <a href="">
                    <i class="ti-arrow-circle-left"></i>
                  </a>
                </div>
              </div>
              <ul class="side-nav-menu scrollable">
                <li class="nav-item">
                  <a class="mrg-top-30" href="index.html">
                    <span class="icon-holder">
                      <i class="ti-home"></i>
                    </span>
                    <span class="title">Home</span>
                  </a>
                </li>
                <li class="nav-item">
                  <a class="mrg-top-30" href="services.html">
                    <span class="icon-holder">
                      <i class="ei-hand"></i>
                    </span>
                    <span class="title">Services</span>
                  </a>
                </li>
                <li class="nav-item">
                  <a class="mrg-top-30" href="apidoc.html">
                    <span class="icon-holder">
                      <i class="ei-file-code"></i>
                    </span>
                    <span class="title">API Documentation</span>
                  </a>
                </li>
                <li class="nav-item">
                  <a class="mrg-top-30" href="contact.html">
                    <span class="icon-holder">
                      <i class="ei-phone-book-contact"></i>
                    </span>
                    <span class="title">Contact</span>
                  </a>
                </li>

              </ul>
            </div>
          </div>
          <!-- Side Nav END -->

            <!-- Page Container START -->
            <div class="page-container">
              <!-- Header START -->
              <div class="header navbar">
                <div class="header-container">
                  <ul class="nav-left">
                    <li>
                      <a class="side-nav-toggle" href="javascript:void(0);">
                        <i class="ti-view-grid"></i>
                      </a>
                    </li>
                  </ul>
                  <ul class="nav nav-right" id="boxSign">
                    <li class="nav-item">
                      <button id="signin" class="nav-link btn btn-outline-success" type="submit" onclick="location.href='sign-in.html'">Sign in</button>

                    </li>
                  </ul>
                </div>
              </div>
              <!-- Header END -->

                <!-- Content Wrapper START -->
                <div class="main-content">
                  <div class="container-fluid">
                    <div class="page-title">
                      <h4>Api Overview</h4>
                    </div>

                    <div class="row">
                      <div class="col-lg-6">
                        <div class="card">
                          <div class="card-heading border bottom">
                            <div class="row">
                              <div class="col-sm-6">
                                <h4 class="card-title">API summary</h4>
                              </div>
                              <div class="col-sm-6">
                                <h4>Current Usage : <span id='usage'></span></h4>
                              </div>
                            </div>
                          </div>
                          <div class="card-block">
                            <canvas id="myChart" width="400" height="400"></canvas>
                          </div>
                        </div>
                      </div>
                      <div class="col-lg-6">
                        <div class="card">
                          <div class="card-heading border bottom">
                            <h4 class="card-title">API current limits</h4>
                            <button type="button" class='btn btn-info float-right' name="button" id='btn-updateLimit'>Update Limit</button>
                          </div>
                          <div class="card-block">
                            <form id='updateLimit'>
                              <div class="form-group col-md-6">
                                <label for="limitSoft">Soft limit :</label>
                                <input type="text" class="form-control" id="limitSoft" placeholder="Soft limit">
                              </div>
                              <div class="form-group col-md-6">
                                <label for="limitHard">Hard limit :</label>
                                <input type="text" class="form-control" id="limitHard" placeholder="Hard limit">
                              </div>
                            </form>
                          </div>
                        </div>
                      </div>
                    </div>
                  </div>
                </div>
                <!-- Content Wrapper END -->
                <!-- Footer START -->
                <footer class="content-footer">
                  <div class="footer">
                    <div class="copyright">
                      <span>Copyright Â© 2018 <b class="text-dark">Namsor</b>. All rights reserved.</span>
                      <span class="go-right">
                        <a href="" class="text-gray mrg-right-15">Term &amp; Conditions</a>
                        <a href="" class="text-gray">Privacy &amp; Policy</a>
                      </span>
                    </div>
                  </div>
                </footer>
                <!-- Footer END -->


            </div>
            <!-- Page Container END -->

        </div>
    </div>

    <!-- build:js assets/js/vendor.js -->
    <!-- plugins js -->
    <script src="bower_components/jquery/dist/jquery.min.js"></script>
    <script src="bower_components/chart.js/dist/Chart.min.js"></script>
    <script src="bower_components/popper.js/dist/umd/popper.min.js"></script>
    <script src="bower_components/bootstrap/dist/js/bootstrap.js"></script>
    <script src="bower_components/PACE/pace.min.js"></script>
    <script src="bower_components/perfect-scrollbar/js/perfect-scrollbar.jquery.js"></script>
    <!-- endbuild -->

    <!-- build:js assets/js/app.min.js -->
    <!-- core js -->
    <script src="https://www.gstatic.com/firebasejs/5.1.0/firebase.js"></script>
    <script src="assets/js/firebase.js" charset="utf-8"></script>
    <script>
      window.onload = function (){
          initApp();
          getUsage().then(usage => {
            usage = JSON.parse(usage);
            let current = usage.billingPeriod.usage;
            let hard = usage.billingPeriod.hardLimit;
            let soft = usage.billingPeriod.softLimit;
            document.getElementById('limitHard').value = hard;
            document.getElementById('limitSoft').value = soft;
            document.getElementById('usage').innerHTML = current;
          });
          document.getElementById('btn-updateLimit').addEventListener('click',function(event) {
            getToken().then(function(token){
              let path = '/NamSorAPIv2/api2/json/updateLimit/';
              let info = []
              getApiKey().then(
                  function(key) {
                    jQuery('#updateLimit').find('input').each(function(index, data){
                      info.push(this.value);
                    });
                    if (parseInt(info[0]) > 0 && parseInt(info[1]) > 0) {
                      if (info[0])
                        request({
                          url: path + info[0] + '/true/' + token,
                          headers : {'X-API-KEY' : key}
                      }).then(function(success){
                        if (info[1])
                        request({
                          url: path + info[1] + '/false/' + token,
                          headers : {'X-API-KEY' : key}
                        }).then(function(good){
                            let success = document.createElement('div');
                            success.className = 'alert alert-success';
                            success.innerHTML = 'You have successfuly updated your limits';
                            document.getElementById('updateLimit').prepend(success);
                        });
                      });
                    } else {
                      let error = document.createElement('div');
                      error.className = 'alert alert-warning';
                      error.innerHTML = 'Make sure that your limits are positive';
                      document.getElementById('updateLimit').prepend(error);
                    }
                });
            });
          });
      }
    </script>
    <script>
      let path = "/NamSorAPIv2/api2/json/apiUsageHistory"
      getApiKey().then(function(key) {
        request({url : path, headers : {'X-API-KEY' : key} }).then(
          function(usage) {
            usage = JSON.parse(usage);
            var ctx = document.getElementById("myChart").getContext('2d');
            var lab = []
            var dat = []
            for (var i = 0; i < usage.length; i++) {
              let info = usage[i]
              lab.push(info.apiService.split('_').join(' ').replace("basic->", ''))
              dat.push(info.totalUsage)
            }
            var myChart = new Chart(ctx, {
              type: 'bar',
              data: {
                  labels: lab,
                  datasets: [{
                      label: 'frequency',
                      data: dat,
                      backgroundColor: [
                          'rgba(255, 99, 132, 0.2)',
                          'rgba(54, 162, 235, 0.2)',
                          'rgba(255, 206, 86, 0.2)',
                          'rgba(75, 192, 192, 0.2)',
                          'rgba(153, 102, 255, 0.2)',
                          'rgba(255, 159, 64, 0.2)'
                      ],
                      borderColor: [
                          'rgba(255,99,132,1)',
                          'rgba(54, 162, 235, 1)',
                          'rgba(255, 206, 86, 1)',
                          'rgba(75, 192, 192, 1)',
                          'rgba(153, 102, 255, 1)',
                          'rgba(255, 159, 64, 1)'
                      ],
                      borderWidth: 1
                  }]
              },
              options: {
                  scales: {
                      yAxes: [{
                          ticks: {
                              beginAtZero:true
                          }
                      }]
                  }
              }
            });
          }, function (error) { console.log(Error(error)) });
      }).catch( error => console.log(error));
      </script>
    <script src="assets/js/app.js"></script>
    <!-- endbuild -->

    <!-- page js -->

</body>

</html>
